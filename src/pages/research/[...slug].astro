---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("research");
  return posts.filter((p) => !p.data.draft).map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const posts = await getCollection("research");
const entry = posts.find((p) => p.slug === slug);
if (!entry) throw new Error(`Post not found: ${slug}`);
const { Content } = await entry.render();
---

<BaseLayout title={entry.data.title} description={entry.data.description}>
  <section class="hero" style="padding-bottom: 0;">
    <div class="container">
      <div class="kicker">
        <a class="badge" href="/research" style="text-decoration:none;">← Back to Research</a>
      </div>
      <h1 style="font-size: clamp(30px, 3.6vw, 44px);">{entry.data.title}</h1>
      <p class="lead" style="max-width: 820px;">{entry.data.description}</p>

      <div class="post-meta" style="margin-top: 14px;">
        <span>{entry.data.date.toISOString().slice(0, 10)}</span>
        {entry.data.tags?.length ? (<><span>•</span><span>{entry.data.tags.join(", ")}</span></>) : null}
      </div>

      <div class="hr"></div>

      <article class="prose">
        <Content />
      </article>
    </div>
  </section>
</BaseLayout>
